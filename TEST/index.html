<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEDIA DOWNLOADER ULTRA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Space+Grotesk:wght@300;700;900&display=swap" rel="stylesheet">

<style>
/* --- VARIABLES & PALETTE --- */
:root {
    --bg-color: #e0e0e0;
    --main-black: #0a0a0a;
    --card-bg: #ffffff;
    --accent-primary: #6a0dad;
    --accent-secondary: #ccff00;
    --accent-tertiary: #ff5f00;
    --border-width: 3px;
    --font-head: 'Space Grotesk', sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: var(--font-head);
    background-color: var(--bg-color);
    color: var(--main-black);
    min-height: 100vh;
    overflow-x: hidden;
    padding-bottom: 100px;
    background-image: 
        linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px);
    background-size: 20px 20px;
}

.bg-noise {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    opacity: 0.04;
    pointer-events: none;
    z-index: -1;
    background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1IiBoZWlnaHQ9IjUiPgo8cmVjdCB3aWR0aD0iNSIgaGVpZ2h0PSI1IiBmaWxsPSIjZmZmIi8+CjxyZWN0IHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9IiMwMDAiLz4KPC9zdmc+');
}

.floating-shape {
    position: fixed;
    z-index: -2;
    border: 2px solid var(--main-black);
    background: var(--accent-secondary);
    opacity: 0.6;
}
.shape-1 { width: 100px; height: 100px; top: 10%; left: -20px; border-radius: 50%; }
.shape-2 { width: 150px; height: 150px; bottom: 20%; right: -40px; transform: rotate(45deg); background: var(--accent-primary); }

/* --- MARQUEE --- */
.marquee-top {
    background: var(--main-black);
    color: var(--card-bg);
    padding: 10px 0;
    font-family: var(--font-mono);
    font-size: 0.8rem;
    font-weight: bold;
    border-bottom: var(--border-width) solid var(--accent-secondary);
    overflow: hidden;
    white-space: nowrap;
}
.marquee-content { display: inline-block; animation: scrollLeft 15s linear infinite; }
@keyframes scrollLeft { from { transform: translateX(0); } to { transform: translateX(-50%); } }

/* --- NAVBAR --- */
.navbar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 1.5rem;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(5px);
    border-bottom: var(--border-width) solid var(--main-black);
    position: sticky; top: 0; z-index: 100;
}

.brand-glitch {
    font-weight: 900; font-size: 1.5rem; letter-spacing: -1px;
    position: relative;
    color: var(--main-black);
}
.brand-glitch::before {
    content: attr(data-text); position: absolute; left: 2px; text-shadow: -1px 0 var(--accent-primary);
    top: 0; color: var(--main-black); background: var(--bg-color); overflow: hidden; clip: rect(0, 900px, 0, 0); animation: glitch 2s infinite linear alternate-reverse;
}

.nav-btn {
    text-decoration: none; color: var(--main-black); font-weight: 800;
    background: var(--accent-secondary); border: 2px solid var(--main-black);
    padding: 8px 15px; box-shadow: 3px 3px 0 var(--main-black);
    font-size: 0.9rem;
}

/* --- CONTAINER & CARD --- */
.container { max-width: 550px; margin: 30px auto; padding: 0 20px; display: flex; flex-direction: column; gap: 30px; }

.cyber-card {
    background: var(--card-bg);
    border: var(--border-width) solid var(--main-black);
    box-shadow: 8px 8px 0 var(--main-black);
    position: relative;
    overflow: hidden;
}

.screw { position: absolute; font-family: monospace; font-weight: bold; font-size: 1.2rem; pointer-events: none; }
.top-left { top: 5px; left: 10px; } .top-right { top: 5px; right: 10px; }
.bottom-left { bottom: 5px; left: 10px; } .bottom-right { bottom: 5px; right: 10px; }

.card-header-visual {
    background: var(--accent-primary);
    padding: 30px 20px 20px 20px;
    border-bottom: var(--border-width) solid var(--main-black);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.profile-section { display: flex; align-items: center; gap: 15px; }

.avatar-img {
    width: 60px; height: 60px;
    border: 3px solid var(--main-black);
    background: #fff;
    border-radius: 12px;
    box-shadow: 4px 4px 0 var(--accent-secondary);
}

.profile-info { display: flex; flex-direction: column; }
.user-role { font-family: var(--font-mono); font-size: 0.7rem; color: var(--accent-secondary); font-weight: bold; letter-spacing: 1px; }
.user-action { font-weight: 900; color: #fff; font-size: 1.1rem; text-transform: uppercase; line-height: 1.1; }

.decor-lines { font-family: var(--font-mono); color: rgba(255,255,255,0.3); font-weight: 900; font-size: 1.5rem; letter-spacing: -2px; }

/* --- INPUT SECTION --- */
.card-body { padding: 25px; }
.input-wrapper { position: relative; margin-bottom: 20px; }
.input-label { font-family: var(--font-mono); font-weight: bold; font-size: 0.8rem; margin-bottom: 8px; display: block; }

.cyber-input {
    width: 100%; padding: 18px;
    border: 3px solid var(--main-black);
    background: #f4f4f4;
    font-family: var(--font-mono); font-size: 1rem; font-weight: bold;
    outline: none; transition: 0.2s;
}
.cyber-input:focus { background: #fff; border-color: var(--accent-tertiary); }

.platform-tags { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
.platform-tags span {
    font-size: 0.75rem; font-weight: bold; background: #eee;
    padding: 4px 8px; border: 1px solid var(--main-black);
    font-family: var(--font-mono);
}

/* --- BUTTON --- */
.cyber-button {
    width: 100%; padding: 18px;
    border: 3px solid var(--main-black);
    background: var(--accent-secondary);
    color: var(--main-black);
    font-family: var(--font-head); font-weight: 900; font-size: 1.2rem;
    text-transform: uppercase; cursor: pointer;
    position: relative; overflow: hidden;
    box-shadow: 5px 5px 0 var(--main-black);
    transition: all 0.1s;
}
.cyber-button:active { transform: translate(3px, 3px); box-shadow: 2px 2px 0 var(--main-black); }
.cyber-button:hover { background: #bfff00; }
.cyber-button:disabled { opacity: 0.6; cursor: not-allowed; }

/* --- RESULT CARD --- */
.result-card {
    background: #fff; border: 3px solid var(--main-black);
    margin-bottom: 20px; padding: 0; box-shadow: 8px 8px 0 rgba(0,0,0,0.2);
}
.result-header {
    background: var(--main-black); color: #fff;
    padding: 10px 15px; display: flex; justify-content: space-between; align-items: center;
    font-family: var(--font-mono); font-size: 0.85rem; font-weight: bold;
}
.result-badge { background: var(--accent-tertiary); color: #000; font-weight: bold; padding: 2px 6px; font-size: 0.7rem; border: 1px solid #fff; }
.result-body { padding: 15px; }

video, img, audio { width: 100%; border: 2px solid var(--main-black); display: block; margin-bottom: 15px; }

/* --- FOOTER --- */
.sann-footer {
    text-align: center; margin-top: 40px; padding-bottom: 20px;
    font-family: var(--font-mono);
}
.footer-line { width: 50px; height: 4px; background: var(--main-black); margin: 0 auto 15px auto; }
.sann-highlight { background: var(--main-black); color: #fff; padding: 2px 6px; font-weight: bold; }

/* --- UTILITIES --- */
.hidden { display: none !important; }

.scanner { width: 100%; height: 4px; background: var(--accent-primary); animation: scan 2s infinite ease-in-out; margin-bottom: 15px; }
@keyframes scan { 0% { width: 0; } 50% { width: 100%; } 100% { width: 0; margin-left: auto; } }
.blink-text { font-family: var(--font-mono); font-weight: bold; animation: blink 1s infinite; }
@keyframes blink { 50% { opacity: 0.5; } }

.error-state { border-color: red; box-shadow: 8px 8px 0 red; }
.error-header { background: red; color: white; padding: 10px; font-weight: bold; font-family: var(--font-mono); }
.error-body { padding: 20px; color: red; font-family: var(--font-mono); font-weight: bold; }

.result-meta {
    margin: 15px 0;
    font-family: var(--font-mono);
    font-size: 0.8rem;
    border-top: 2px dashed #ccc;
    padding-top: 10px;
}

@keyframes glitch { 0% { clip: rect(20px, 9999px, 10px, 0); } 100% { clip: rect(50px, 9999px, 80px, 0); } }
</style>
</head>
<body>

    <div class="bg-noise"></div>
    <div class="floating-shape shape-1"></div>
    <div class="floating-shape shape-2"></div>

    <div class="marquee-top">
        <div class="marquee-content">
            SYSTEM READY • V.3.0 ULTRA • NO WATERMARK • FAST SPEED • SECURE • SANN404 • SYSTEM READY • V.3.0 ULTRA • NO WATERMARK • FAST SPEED • SECURE • SANN404 •
        </div>
    </div>

    <nav class="navbar">
        <div class="brand-container">
            <div class="brand-glitch" data-text="MD-ULTRA">MediaDownloader</div>
        </div>
        <a href="docs.html" class="nav-btn">BACA YA INI</a>
    </nav>

    <div class="container">
        
        <div class="cyber-card main-card">
            <div class="screw top-left">+</div>
            <div class="screw top-right">+</div>
            <div class="screw bottom-left">+</div>
            <div class="screw bottom-right">+</div>

            <div class="card-header-visual">
                <div class="profile-section">
                    <img src="63985eb0b043dbf2bcdc175f50acb386.jpg" alt="User Profile" class="avatar-img" id="userAvatar"
                         onerror="this.style.display='none'">
                    <div class="profile-info">
                        <span class="user-role">ADMINISTRATOR</span>
                        <span class="user-action">PASTE YOUR LINK BELOW</span>
                    </div>
                </div>
                <div class="decor-lines">///</div>
            </div>
            
            <div class="card-body">
                <div class="input-wrapper">
                    <div class="input-label">TARGET URL:</div>
                    <input type="text" id="urlInput" class="cyber-input" placeholder="https://tiktok.com/..." autocomplete="off">
                </div>

                <div class="platform-tags">
                    <span>#TIKTOK</span> <span>#IG</span> <span>#YT</span> <span>#FB</span> <span>#X</span>
                </div>
                
                <button id="downloadBtn" onclick="fetchMedia()" class="cyber-button">
                    <span class="btn-text">INITIATE DOWNLOAD</span>
                </button>
            </div>
        </div>

        <div id="loading" class="cyber-card hidden" style="text-align: center; padding: 40px;">
            <div class="scanner"></div>
            <p class="blink-text">PROCESSING DATA STREAM...</p>
        </div>

        <div id="error-msg" class="cyber-card error-state hidden">
            <div class="error-header">SYSTEM ERROR</div>
            <div class="error-body" id="error-text"></div>
        </div>

        <div id="result" class="result-stack"></div>

        <footer class="sann-footer">
            <div class="footer-line"></div>
            <p>POWERED BY <span class="sann-highlight">SANN404 FORUM</span></p>
            <p style="font-size: 0.7rem; opacity: 0.6; margin-top: 5px;">ENGINEERED FOR PERFORMANCE</p>
        </footer>

    </div>

<script>
async function fetchMedia() {
    const input = document.getElementById('urlInput');
    const btn = document.getElementById('downloadBtn');
    const loading = document.getElementById('loading');
    const resultDiv = document.getElementById('result');
    const errorCard = document.getElementById('error-msg');
    const errorText = document.getElementById('error-text');
    const url = input.value.trim();

    if (!url) return;

    btn.disabled = true;
    loading.classList.remove('hidden');
    resultDiv.innerHTML = '';
    errorCard.classList.add('hidden');

    try {
        const response = await fetch('/api/index', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url })
        });

        const json = await response.json();

        if (!response.ok || !json.success) {
            throw new Error(json.error || 'Media tidak ditemukan / Link Invalid.');
        }

        renderResult(json.data);

    } catch (err) {
        errorText.textContent = err.message;
        errorCard.classList.remove('hidden');
    } finally {
        btn.disabled = false;
        loading.classList.add('hidden');
    }
}

function renderResult(medias) {
    const resultDiv = document.getElementById('result');

    medias.forEach((media, index) => {
        const card = document.createElement('div');
        card.className = 'cyber-card result-card';
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'all 0.4s ease';
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);

        let typeTitle = 'MEDIA_FILE';
        let mediaPreview = '';
        const ext = media.extension || 'mp4';
        const filename = `Sann404_DL_${Date.now()}_${index}.${ext}`;

        if (media.type === 'video') {
            typeTitle = `VIDEO_DATA [${media.quality || 'HD'}]`;
            mediaPreview = `
                <div style="background:#000; padding:5px; border:2px solid #000;">
                    <video controls poster="${media.thumbnail || ''}" playsinline style="border:none; margin:0;">
                        <source src="${media.url}" type="video/mp4">
                    </video>
                </div>`;
        } else if (media.type === 'image') {
            typeTitle = 'IMAGE_DATA';
            mediaPreview = `<img src="${media.url}" alt="Result">`;
        } else if (media.type === 'audio') {
            typeTitle = 'AUDIO_STREAM';
            mediaPreview = `<audio controls style="width:100%;"><source src="${media.url}" type="audio/mpeg"></audio>`;
        }

        card.innerHTML = `
            <div class="result-header">
                <span>${typeTitle}</span>
                <span class="result-badge">SUCCESS</span>
            </div>
            <div class="result-body">
                ${mediaPreview}
                <div class="result-meta">
                    > FILENAME: ${filename} <br>
                    > SIZE: UNKNOWN
                </div>
                <button class="cyber-button" style="background: var(--accent-tertiary); color:white; border-color:black;"
                    onclick="forceDownload('${media.url}', '${filename}', this)">
                    DOWNLOAD NOW
                </button>
            </div>
        `;

        resultDiv.appendChild(card);
    });
}

async function forceDownload(url, filename, btnElement) {
    const originalText = btnElement.innerText;
    btnElement.innerText = "DOWNLOADING...";
    btnElement.disabled = true;

    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Network error");
        
        const blob = await response.blob();
        const blobUrl = window.URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = blobUrl;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(blobUrl);
        document.body.removeChild(a);

    } catch (e) {
        console.error("Direct download failed, opening in new tab", e);
        window.location.href = url; 
    } finally {
        btnElement.innerText = "COMPLETED";
        setTimeout(() => {
            btnElement.innerText = originalText;
            btnElement.disabled = false;
        }, 2000);
    }
}
</script>
</body>
</html>
