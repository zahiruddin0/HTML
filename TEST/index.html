<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Radio Malaysia</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: #0a0a0a;
      color: #e0e0e0;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
    }
    
    .header h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }
    
    .header p {
      color: #888;
      font-size: 0.9rem;
    }
    
    .player {
      background: #111;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid #222;
    }
    
    .now-playing {
      text-align: center;
      margin-bottom: 24px;
    }
    
    .station-display {
      font-size: 1.3rem;
      font-weight: 600;
      color: #fff;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .visualizer {
      display: none;
      gap: 3px;
    }
    
    .visualizer.active {
      display: inline-flex;
    }
    
    .bar {
      width: 3px;
      height: 16px;
      background: #4ade80;
      border-radius: 2px;
      animation: wave 1s infinite ease-in-out;
    }
    
    .bar:nth-child(2) { animation-delay: 0.2s; }
    .bar:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes wave {
      0%, 100% { transform: scaleY(0.3); }
      50% { transform: scaleY(1); }
    }
    
    .controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .play-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #4ade80;
      border: none;
      color: #000;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .play-btn:hover {
      transform: scale(1.05);
      background: #5ae88f;
    }
    
    .volume-control {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #1a1a1a;
      padding: 12px 16px;
      border-radius: 50px;
    }
    
    .volume-control i {
      color: #888;
      font-size: 1rem;
    }
    
    .volume-slider {
      width: 100px;
      height: 4px;
      background: #333;
      border-radius: 2px;
      outline: none;
      -webkit-appearance: none;
    }
    
    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: #4ade80;
      border-radius: 50%;
      cursor: pointer;
    }
    
    .extra-controls {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .control-btn {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      color: #888;
      padding: 10px 18px;
      border-radius: 50px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .control-btn:hover {
      background: #222;
      color: #fff;
      border-color: #333;
    }
    
    .control-btn.active {
      background: #4ade80;
      color: #000;
      border-color: #4ade80;
    }
    
    .search-section {
      margin-bottom: 20px;
    }
    
    .search-input {
      width: 100%;
      padding: 14px 18px;
      background: #111;
      border: 1px solid #222;
      border-radius: 12px;
      color: #fff;
      font-size: 0.95rem;
      outline: none;
      transition: all 0.2s;
    }
    
    .search-input::placeholder {
      color: #555;
    }
    
    .search-input:focus {
      border-color: #4ade80;
      background: #151515;
    }
    
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      background: #111;
      padding: 6px;
      border-radius: 12px;
      border: 1px solid #222;
    }
    
    .tab {
      flex: 1;
      padding: 10px;
      background: transparent;
      border: none;
      color: #888;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
    }
    
    .tab.active {
      background: #1a1a1a;
      color: #4ade80;
    }
    
    .stations-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
    }
    
    .station-card {
      background: #111;
      border: 1px solid #222;
      border-radius: 12px;
      padding: 16px 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      font-size: 0.9rem;
      color: #ccc;
    }
    
    .station-card:hover {
      background: #1a1a1a;
      border-color: #333;
      transform: translateY(-2px);
    }
    
    .station-card.active {
      background: #4ade80;
      color: #000;
      border-color: #4ade80;
      font-weight: 600;
    }
    
    .favorite-btn {
      position: absolute;
      top: 6px;
      right: 6px;
      background: none;
      border: none;
      color: #444;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      z-index: 10;
    }
    
    .favorite-btn:hover {
      color: #ff6b6b;
      transform: scale(1.15);
    }
    
    .favorite-btn.active {
      color: #ff6b6b;
    }
    
    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #111;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.8);
      z-index: 1000;
      display: none;
      border: 1px solid #222;
    }
    
    .error-message {
      background: #1a0000;
      color: #ff6b6b;
      padding: 12px 16px;
      border-radius: 8px;
      margin-top: 16px;
      display: none;
      font-size: 0.85rem;
      border: 1px solid #330000;
    }
    
    .sleep-timer-container {
      position: relative;
    }
    
    .sleep-timer-dropdown {
      position: absolute;
      top: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      background: #111;
      border: 1px solid #222;
      border-radius: 12px;
      padding: 12px;
      width: 220px;
      z-index: 100;
      box-shadow: 0 10px 40px rgba(0,0,0,0.8);
      display: none;
    }
    
    .sleep-timer-dropdown.active {
      display: block;
    }
    
    .timer-options {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .timer-option {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      padding: 10px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      color: #ccc;
      font-size: 0.85rem;
    }
    
    .timer-option:hover {
      background: #222;
      border-color: #4ade80;
      color: #fff;
    }
    
    .timer-display {
      font-size: 0.85rem;
      margin-top: 10px;
      padding: 8px;
      background: #1a1a1a;
      border-radius: 8px;
      text-align: center;
      border: 1px dashed #4ade80;
      display: none;
      color: #4ade80;
    }
    
    .timer-display.active {
      display: block;
    }
    
    @media (max-width: 768px) {
      .header h1 { font-size: 1.6rem; }
      .stations-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }
      .volume-slider { width: 80px; }
      .extra-controls { flex-direction: column; align-items: center; }
      .control-btn { width: 100%; max-width: 200px; justify-content: center; }
    }
    
    @media (max-width: 480px) {
      body { padding: 12px; }
      .header h1 { font-size: 1.4rem; }
      .player { padding: 20px; }
      .stations-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; }
      .station-card { padding: 12px 8px; font-size: 0.8rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸŽµ Radio Malaysia</h1>
      <p>Strim langsung pilihan terbaik</p>
    </div>

    <div class="player">
      <div class="now-playing">
        <div class="station-display">
          <span id="stationName">Pilih Stesen</span>
          <div class="visualizer" id="visualizer">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="play-btn" id="playBtn">
          <i class="fas fa-play" id="playIcon"></i>
        </button>
        
        <div class="volume-control">
          <i class="fas fa-volume-up"></i>
          <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="0.7">
        </div>
      </div>
      
      <div class="extra-controls">
        <div class="sleep-timer-container">
          <button class="control-btn" id="sleepTimerBtn">
            <i class="fas fa-moon"></i>
            <span id="sleepTimerText">Pemasa</span>
          </button>
          <div class="sleep-timer-dropdown" id="sleepTimerDropdown">
            <div class="timer-options">
              <div class="timer-option" data-minutes="15">15 Minit</div>
              <div class="timer-option" data-minutes="30">30 Minit</div>
              <div class="timer-option" data-minutes="60">1 Jam</div>
              <div class="timer-option" id="cancelTimer">Batal</div>
            </div>
            <div class="timer-display" id="timerDisplay"></div>
          </div>
        </div>
        
        <button class="control-btn" id="favoritesBtn">
          <i class="fas fa-heart"></i>
          <span>Kegemaran</span>
        </button>
      </div>
      
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="search-section">
      <input type="text" class="search-input" id="searchInput" placeholder="ðŸ” Cari stesen...">
    </div>

    <div class="tabs">
      <button class="tab active" id="allStationsTab">Semua</button>
      <button class="tab" id="favoritesTab">Kegemaran</button>
    </div>

    <div class="stations-grid" id="stationsGrid"></div>
  </div>

  <div class="loading" id="loading"><i class="fas fa-spinner fa-spin"></i> Memuatkan...</div>
  <audio id="audioPlayer" style="display: none;"></audio>

  <script>
    const stations = [
      { name: 'Era', url: 'https://n13.rcs.revma.com/crec9cmbv4uvv/13_b3tkiac680b302/playlist.m3u8', type: 'm3u8' },
      { name: 'Hot FM', url: 'https://n09.rcs.revma.com/drakdf8mtd3vv/9_15wt5oojtyqo002/playlist.m3u8', type: 'm3u8' },
      { name: 'Sinar', url: 'https://n01.rcs.revma.com/azatk0tbv4uvv/1_11a5yc3kn9ion02/playlist.m3u8', type: 'm3u8' },
      { name: 'Hitz FM', url: 'https://n14.rcs.revma.com/488kt4sbv4uvv/14_u3tcp2wu9q1l02/playlist.m3u8', type: 'm3u8' },
      { name: 'Fly FM', url: 'https://n16.rcs.revma.com/q17aka9mtd3vv/16_bsg38prd9vlj02/playlist.m3u8', type: 'm3u8' },
      { name: 'Mix FM', url: 'https://n06.rcs.revma.com/v5pq3htbv4uvv/6_18aiu7hejxpf402/playlist.m3u8', type: 'm3u8' },
      { name: 'My FM', url: 'https://n08.rcs.revma.com/hc3unrtbv4uvv/8_1xcfbljp5h4kh02/playlist.m3u8', type: 'm3u8' },
      { name: 'Gegar', url: 'https://n04.rcs.revma.com/cn0zcqsbv4uvv/4_1l8b0uuius0ad02/playlist.m3u8', type: 'm3u8' },
      { name: 'Zayan', url: 'https://n40a-eu.rcs.revma.com/7ww2a4tbv4uvv/64_2yvaj6nnb69x02/playlist.m3u8', type: 'm3u8' },
      { name: 'Ikim FM', url: 'https://ais-sa8.cdnstream1.com/5035', type: 'mp3' },
      { name: 'Lite FM', url: 'https://stream.rcs.revma.com/2483gbtbv4uvv/hls.m3u8', type: 'm3u8' },
      { name: 'Eight FM', url: 'https://n08.rcs.revma.com/qp0xrd9mtd3vv/8_18nbo6343bsv702/playlist.m3u8', type: 'm3u8' },
      { name: '988 FM', url: 'https://22243.live.streamtheworld.com:443/988_FM.mp3', type: 'mp3' },
      { name: 'Melody FM', url: 'https://n05.rcs.revma.com/2u1n6dtbv4uvv/5_bl5fx9vxqa7002/playlist.m3u8', type: 'm3u8' },
      { name: 'Raaga FM', url: 'https://n06.rcs.revma.com/1ut6qwtbv4uvv/6_1grktyf0p5qpr02/playlist.m3u8', type: 'm3u8' },
      { name: 'Best FM', url: 'https://n16.rcs.revma.com/h34x4kgg9hhvv/16_uf5os5tk9j3302/playlist.m3u8', type: 'm3u8' },
      { name: 'Kool 101', url: 'https://n08.rcs.revma.com/3930238mtd3vv/8_2whawsg3fhmw02/playlist.m3u8', type: 'm3u8' },
      { name: 'Traxx FM', url: 'https://28103.live.streamtheworld.com:443/TRAXX_FMAAC_SC', type: 'aac' },
      { name: 'Molek FM', url: 'https://n09.rcs.revma.com/z56xa78mtd3vv/9_13apqo12zyyxc02/playlist.m3u8', type: 'm3u8' },
      { name: 'Klasik FM', url: 'https://28163.live.streamtheworld.com:443/RADIO_KLASIKAAC.aac', type: 'aac' },
      { name: 'Nasional FM', url: 'https://22253.live.streamtheworld.com:443/NASIONAL_FMAAC_SC', type: 'aac' },
      { name: 'Johor FM', url: 'https://22273.live.streamtheworld.com:443/JOHOR_FMAAC_SC', type: 'aac' },
      { name: 'Kelantan FM', url: 'https://22253.live.streamtheworld.com/KELANTAN_FMAAC.aac', type: 'aac' },
      { name: 'Pahang FM', url: 'https://22253.live.streamtheworld.com:443/PAHANG_FMAAC.aac', type: 'aac' },
      { name: 'Sabah FM', url: 'https://22253.live.streamtheworld.com:443/SABAH_FMAAC.aac', type: 'aac' },
      { name: 'Sarawak FM', url: 'https://22273.live.streamtheworld.com:443/SARAWAK_FMAAC.aac', type: 'aac' },
      { name: 'BFM', url: 'https://22273.live.streamtheworld.com:443/BFMAAC.aac', type: 'aac' },
      { name: 'Awani FM', url: 'https://d2idp3hzkhjpih.cloudfront.net/out/v1/4b85d9c2bf97413eb0c9fd875599b837/index_3.m3u8', type: 'm3u8' },
      { name: 'Jazz FM', url: 'https://stream-eu-a.rcs.revma.com/c718dfvbv4uvv/54_7d1x7i1isy7w02/playlist.m3u8', type: 'm3u8' },
      { name: 'Opus FM', url: 'https://stream-eu-a.rcs.revma.com/aqvp4yvbv4uvv/51_xbchzd3wxcmv02/playlist.m3u8', type: 'm3u8' }
    ];

    const audioPlayer = document.getElementById('audioPlayer');
    const playBtn = document.getElementById('playBtn');
    const playIcon = document.getElementById('playIcon');
    const stationName = document.getElementById('stationName');
    const volumeSlider = document.getElementById('volumeSlider');
    const searchInput = document.getElementById('searchInput');
    const stationsGrid = document.getElementById('stationsGrid');
    const loading = document.getElementById('loading');
    const errorMessage = document.getElementById('errorMessage');
    const visualizer = document.getElementById('visualizer');
    const sleepTimerBtn = document.getElementById('sleepTimerBtn');
    const sleepTimerDropdown = document.getElementById('sleepTimerDropdown');
    const sleepTimerText = document.getElementById('sleepTimerText');
    const timerDisplay = document.getElementById('timerDisplay');
    const favoritesBtn = document.getElementById('favoritesBtn');
    const allStationsTab = document.getElementById('allStationsTab');
    const favoritesTab = document.getElementById('favoritesTab');

    let currentStationData = null;
    let hls = null;
    let favorites = new Set();
    let sleepTimer = null;
    let remainingTime = 0;
    let isShowingFavorites = false;

    function init() {
      const saved = localStorage.getItem('radioFavorites');
      if (saved) favorites = new Set(JSON.parse(saved));
      
      renderStations(stations);
      audioPlayer.volume = volumeSlider.value;
      
      playBtn.addEventListener('click', togglePlay);
      volumeSlider.addEventListener('input', () => audioPlayer.volume = volumeSlider.value);
      searchInput.addEventListener('input', handleSearch);
      allStationsTab.addEventListener('click', () => switchTab('all'));
      favoritesTab.addEventListener('click', () => switchTab('favorites'));
      sleepTimerBtn.addEventListener('click', () => sleepTimerDropdown.classList.toggle('active'));
      
      document.querySelectorAll('.timer-option').forEach(opt => {
        if (opt.id !== 'cancelTimer') {
          opt.addEventListener('click', () => setSleepTimer(parseInt(opt.dataset.minutes)));
        }
      });
      
      document.getElementById('cancelTimer').addEventListener('click', cancelSleepTimer);
      
      document.addEventListener('click', (e) => {
        if (!sleepTimerBtn.contains(e.target) && !sleepTimerDropdown.contains(e.target)) {
          sleepTimerDropdown.classList.remove('active');
        }
      });
    }

    function renderStations(list) {
      stationsGrid.innerHTML = list.map(s => `
        <div class="station-card" data-name="${s.name}">
          <button class="favorite-btn ${favorites.has(s.name) ? 'active' : ''}" data-name="${s.name}">
            <i class="fas fa-heart"></i>
          </button>
          ${s.name}
        </div>
      `).join('');
      
      document.querySelectorAll('.station-card').forEach(card => {
        card.addEventListener('click', (e) => {
          if (!e.target.closest('.favorite-btn')) {
            playStation(stations.find(s => s.name === card.dataset.name));
          }
        });
      });
      
      document.querySelectorAll('.favorite-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleFavorite(btn.dataset.name);
        });
      });
    }

    function toggleFavorite(name) {
      favorites.has(name) ? favorites.delete(name) : favorites.add(name);
      localStorage.setItem('radioFavorites', JSON.stringify([...favorites]));
      renderStations(isShowingFavorites ? stations.filter(s => favorites.has(s.name)) : stations);
    }

    function switchTab(tab) {
      isShowingFavorites = tab === 'favorites';
      allStationsTab.classList.toggle('active', tab === 'all');
      favoritesTab.classList.toggle('active', tab === 'favorites');
      renderStations(isShowingFavorites ? stations.filter(s => favorites.has(s.name)) : stations);
      searchInput.value = '';
    }

    function playStation(station) {
      if (!station) return;
      
      document.querySelectorAll('.station-card').forEach(c => c.classList.remove('active'));
      const card = document.querySelector(`.station-card[data-name="${station.name}"]`);
      if (card) card.classList.add('active');
      
      currentStationData = station;
      stationName.textContent = station.name;
      loading.style.display = 'block';
      errorMessage.style.display = 'none';
      
      audioPlayer.pause();
      if (hls) hls.destroy();
      
      if (station.type === 'm3u8' && Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(station.url);
        hls.attachMedia(audioPlayer);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          audioPlayer.play().then(() => {
            loading.style.display = 'none';
            updatePlayState(true);
          }).catch(handleError);
        });
      } else {
        audioPlayer.src = station.url;
        audioPlayer.play().then(() => {
          loading.style.display = 'none';
          updatePlayState(true);
        }).catch(handleError);
      }
    }

    function togglePlay() {
      if (audioPlayer.paused) {
        if (currentStationData) {
          audioPlayer.play().then(() => updatePlayState(true)).catch(handleError);
        } else {
          showError('Pilih stesen terlebih dahulu');
        }
      } else {
        audioPlayer.pause();
        updatePlayState(false);
      }
    }

    function updatePlayState(playing) {
      playIcon.className = playing ? 'fas fa-pause' : 'fas fa-play';
      visualizer.classList.toggle('active', playing);
      loading.style.display = 'none';
    }

    function setSleepTimer(minutes) {
      cancelSleepTimer();
      remainingTime = minutes * 60;
      sleepTimerText.textContent = `${minutes}m`;
      sleepTimerBtn.classList.add('active');
      timerDisplay.classList.add('active');
      sleepTimerDropdown.classList.remove('active');
      
      updateTimerDisplay();
      sleepTimer = setInterval(() => {
        remainingTime--;
        updateTimerDisplay();
        if (remainingTime <= 0) {
          cancelSleepTimer();
          audioPlayer.pause();
          updatePlayState(false);
        }
      }, 1000);
    }

    function cancelSleepTimer() {
      if (sleepTimer) clearInterval(sleepTimer);
      sleepTimer = null;
      sleepTimerText.textContent = 'Pemasa';
      sleepTimerBtn.classList.remove('active');
      timerDisplay.classList.remove('active');
    }

    function updateTimerDisplay() {
      if (remainingTime > 0) {
        const m = Math.floor(remainingTime / 60);
        const s = remainingTime % 60;
        timerDisplay.textContent = `${m}:${s.toString().padStart(2, '0')}`;
      }
    }

    function handleSearch(e) {
      const term = e.target.value.toLowerCase();
      const list = isShowingFavorites ? stations.filter(s => favorites.has(s.name)) : stations;
      renderStations(list.filter(s => s.name.toLowerCase().includes(term)));
    }

    function handleError(err) {
      console.error(err);
      showError('Ralat main balik. Cuba stesen lain.');
      updatePlayState(false);
    }

    function showError(msg) {
      errorMessage.textContent = msg;
      errorMessage.style.display = 'block';
      loading.style.display = 'none';
    }

    init();
  </script>
</body>
</html>
